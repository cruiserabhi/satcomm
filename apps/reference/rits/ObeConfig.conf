#****************************************************************************
#  Copyright (c) 2019-2021, The Linux Foundation. All rights reserved.
# *
# *  Redistribution and use in source and binary forms, with or without
# *  modification, are permitted provided that the following conditions are
# *  met:
# *    * Redistributions of source code must retain the above copyright
# *      notice, this list of conditions and the following disclaimer.
# *    * Redistributions in binary form must reproduce the above
# *      copyright notice, this list of conditions and the following
# *      disclaimer in the documentation and/or other materials provided
# *      with the distribution.
# *    * Neither the name of The Linux Foundation nor the names of its
# *      contributors may be used to endorse or promote products derived
# *      from this software without specific prior written permission.
# *
# *  THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
# *  WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
# *  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
# *  ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
# *  BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
# *  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
# *  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
# *  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
# *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
# *  OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
# *  IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#/*
# *  Changes from Qualcomm Innovation Center, Inc. are provided under the following license:
# *
# *  Copyright (c) 2022-2025 Qualcomm Innovation Center, Inc. All rights reserved.
# *
# * Redistribution and use in source and binary forms, with or without
# * modification, are permitted (subject to the limitations in the
# * disclaimer below) provided that the following conditions are met:
# *
# *     * Redistributions of source code must retain the above copyright
# *       notice, this list of conditions and the following disclaimer.
# *
# *     * Redistributions in binary form must reproduce the above
# *       copyright notice, this list of conditions and the following
# *       disclaimer in the documentation and/or other materials provided
# *       with the distribution.
# *
# *     * Neither the name of Qualcomm Innovation Center, Inc. nor the names of its
# *       contributors may be used to endorse or promote products derived
# *       from this software without specific prior written permission.
# *
# * NO EXPRESS OR IMPLIED LICENSES TO ANY PARTY'S PATENT RIGHTS ARE
# * GRANTED BY THIS LICENSE. THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT
# * HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED
# * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
# * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
# * IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
# * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
# * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
# * GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
# * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER
# * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
# * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
# * IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
# */
#
#
#
#     File Name:     ObeConfig.conf   FOR C-V2X
#     Revision Date: Jan 29, 2024 Rev. 1
#
#****************************************************************************

# by default the ITS process priority should be always be set to highest (-20)
# however, for testing purposes, qits priority can be altered
procPriority = -20

#**************************************************************************
#*                   Simulation/Live Parameters                            *
#**************************************************************************/
# EnablePreRecorded: Bool; Simulate from pre-recorded file, false is live data.
EnablePreRecorded = false
# PreRecordedFile: String (*.csv); Simulation data file full path /home/root/<fname>.
PreRecordedFile = /full/path/to/myrec.csv
# preRecordedBsmLog: Bool; true if PreRecordedFile is of BSM data format; false for other formats.
preRecordedBsmLog = false

#**************************************************************************
#*                   Key C-V2X Paramters                                  *
#**************************************************************************/
#wildcardRx: true/false, if true, it will receive ALL OTA cv2x packets.
wildcardRx = false
# TransmitRateInterval: Integer; Millisec interval at which BSMs are sent.
TransmitRateInterval = 100
# SpsPeriodicity: Integer (10,20,50,100); Millisec interval for SPS flow periodicity
SpsPeriodicity = 100
# SpsFlows: Integer (1-100); Number of Sps Flows to start with.
SpsFlows = 1
# SpsPorts: Integer (0-65535) List of SpsFlows size; List of ports used for Sps.
SpsPorts = 9000
# SpsDestAddrs: String; IP V6 destination address.
SpsDestAddrs = ff02::1:8998
# SpsDestPorts: String; Port of the dest address.
SpsDestPorts = 2500,2550
# SpsServiceIDs: Integer (0-2^32) List; ServiceIDs for each sps flow separated by only comma.
SpsServiceIDs = 32
# EventFlows: Integer (0- 100); Number of open Event Flows at start.
EventFlows = 2
# EventPorts: Integer (0-65535) List of EventFlows size; List of ports used for Events.
EventPorts = 2550
# EventDestAddrs: String; IP V6 destination address.
EventDestAddrs = ff02::1:9000,ff02::1:9001
# EventDestPorts: String; Port of the dest address.
EventDestPorts = 9000
# EventServiceIDs: Integer (0-2^32) Byte List; ServiceIDs for each event flow separated by only comma.
EventServiceIDs = 32
# ReceiveFlows: Integer (1- 100); Number of parallel Receive Flows at start.
ReceiveFlows = 1
# ReceivePorts: Integer (0-65535) List of ReceiveFlows size; List of ports used for Receives.
ReceivePorts = 9000
# ReceiveSubId: Integer (0-2^32) List; ServiceIDs for each rx subscription separated by only comma.
ReceiveSubIds = 32
# LocationInterval: Integer (1-1000); Millisec interval at which the system tries to get GPS fixes.
LocationInterval = 100
# Enable or Disable Location Fixes; Set this to false to run qits without kinematics dependency
enableLocationFixes = true
enableDistanceLogs = false # set to true to enable 2d distance calc and logs when -o command line arg used
positionOverride = false # set to true to use below position values instead of gnss fixes
overrideLat = 0.0
overrideLong = 0.0
overrideHead = 0.0
overrideElev = 0.0
overrideSpeed = 0.0
# Enable or Disable Vehicle Data Callbacks; set this to false if there is no CAN support
enableVehicleDataCallbacks = false
# WRAServiceID: Integer (0-2^32); ServiceID used for WRA message.
WraServiceID = 4
# Leap Seconds default value until available from gnss fix; should be updated in future
leapSeconds = 18

#**************************************************************************
#*                     LDM Parameters                                     *
#**************************************************************************/
#LdmSize: pre-allocated size for BSMs.
LdmSize = 0
#LdmGbTime: Ldm garbage collector time interval for collections in seconds.
LdmGbTime = 5
#Ldm parameter that represents the max allowed age from the data timestamps in seconds.
LdmGbTimeThreshold = 4

#**************************************************************************
#*                    SAE J2735 Configuration Items                       *
#**************************************************************************/

# Basic Safety Message Part I Configuration Items
# BsmJitter: Integer (0-1000); Millisec added jitter to every Bsm transmit.
BsmJitter = 0
# EnableVehicleExt: Bool; Enable and include Vehicle Ext. fields in Bsm.
EnableVehicleExt = false
# PathHistoryPoints: Integer (1-15) Number of path history points to be included.
PathHistoryPoints = 1

#Vehicle Status Configuration Items
# Integer (0-1023); Vehicle Width in 1 cm units.
VehicleWidth = 70
# Integer (0-4095); Vehicle Length in 1 cm units.
VehicleLength = 50
# Integer (0-127); Vehicle Height in 5 cm units.
VehicleHeight = 2
# Integer (0-127); Bumper Height from surface in 1 cm units.
FrontBumperHeight = 1
# Integer (0-127); Bumper Height from surface in 1 cm units.
RearBumperHeight = 1
# Integer (0-255); Vehicle mass in encoded form; see J2735.
VehicleMass = 1200
# BasicVehicleClass: Integer (0-255) # As per J2735 BasicVehicleClass
# 10: Default Car
# 60: Emergency vehicle.
# 52: transit - BRT
# 82: Pedestrian
# 85: Bicycle
BasicVehicleClass = 60
# Integer   # 0 - unavailable #1 - Not in use , #2 - In use
SirenInUse = 2
# Integer
# 0 - unavailable
# 1 - not in use
# 2 - in use
# 3 - yellow caution lights
# 4 - schoolbus lights
# 5 - arrow signs active
# 6 - slow moving vehicle
# 7 - frequent stops
LightBarInUse = 5
# Integer (0, 65535) # ITIS codes for special vehicle
# 1796 - Emergency vehicle on roadway
# 8968 - Rapid transit
SpecialVehicleTypeEvent = 1796
# Integer (0, 127) # Vehicle type, see J2735
VehicleType = 4

#**************************************************************************
#*                    Tunnel Timing Configurations Thresholds             *
#**************************************************************************/
# Time of confidence threshold in nanoseconds e.g. 6000 means 6 microseconds.
TTunc = 6000
# BSM age threshold in milliseconds, relates to the gbCollector BSM.
TAge = 5
# Number of packet errors.
TPacketError = 15
# 3D uncertainty in meters calculated by Sqrt(horUncEllipseSemiMajor^2 +
#      horUncEllipseSemiMinor^2 + vertUnc^2)
TUncertainty3D = 2
# Distance of the remote vehicle with respect to host vehicl
TDistance = 300

#**************************************************************************
#*                    ETSI config data                                    *
#**************************************************************************/
MacAddr                 = 00:0a:0b:0c:0d:0e
StationType             = 4
CAMDestinationPort      = 2001

#**************************************************************************
#*                    Security                                            *
#**************************************************************************/
EnableSecurity          = false
SecurityContextName     = smdemo.wsc
SecurityCountryCode     = 0x348 # CountryCode in hexadecimal format
                                # India- 356(0x164)
                                # France - 250 (0xFA)
                                # US-840 (0x348)
psidValue               = 0x20 # PSID in hexadecimal format used for signing
                               # Examples are:
                               # 0x20 for BSM, 0x24 for CAM, 0x6f for China BSM
                               # Note: this can differ from the sps service id value for testing.
overridePsidCheck       = false # for debug/testing purposes only
                                # this will override the received packet's PSID with BSM psid
                                # this does not affect QITS in ETSI mode
enableSsp               = false # must be true for Brainpool/ETSI profile
sspValue                = 01:ff:fc #hexadecimal format bytes separated by colons
enableSspMask           = false # set to true for Brainpool/ETSI profile
sspMask                 = ff:ff:ff # ssp bit masking value separated by colons
                                # must be same size as the sspValue parameter
#externalDataHash       = 00:00:00:00:00:00:00:00:00:00
setGenLocation          = true # this should change based on the type of packet according to spec
                               # this parameter is used when the IEEE 1609.2 header of a specific
                               # packet is expected to not incude a sender's (RV) position by default
                               # Position is then extracted from the decoded packet and then provided to
                               # Aerolink for consistency/relevancy checks.
                               # e.g., when receiving a BSM, the IEEE 1609.2 header will not include 
                               # position of the RV. So the HV decodes the BSM and then provides the
                               # decoded position to Aerolink for consistency/relevancy checks.
enableAsync             = true # asynchronous signing or verification; note: use 1 numRxThread
enableConsistency       = true # true/false enable/disable consistency security checks
enableRelevance         = true # true/false; enable /disable relevance security checks

enableEncrypt           = false # true/false for disabled/enabled ; If enabled, signing is automatically enabled
enableVerifStatLog      = false # true/false. False by default.
                             # If true, logging is enabled and results are
                             # dumped to verifStatLogFile on program exit
verifStatLogListSize    = 10000 # By default this is 10000. This specifies the
                             # logged statistics of the last N verified packets.
                             # Each thread has unique list.
verifStatLogFile        = /tmp/verif_stats.log
                             # By default, this is /tmp/verif_stats.log.
enableSignStatLog       = false # true/false. False by default.
                             # If true, logging is enabled and results are
                             # dumped to signStatLogFile on program exit
signStatLogListSize     = 10000 # By default this is 10000. This specifies the
                             # logged statistics of the last N signied packets.
                             # Each thread has unique list.
signStatLogFile         = /tmp/sign_stats.log
                             # By default, this is /tmp/sign_stats.log.
enableVerifResLog      = false # true/false. False by default.
                             # If true, logging is enabled and results are
                             # dumped to verifResLogFile on program exit
verifResLogSize          = 10000 # By default this is 10000. This specifies the
                             # logged detailed results of the last N verified packets.
                             # Each thread has unique list.
verifResLogFile        = /tmp/verif_results.log
                             # By default, this is /tmp/verif_results.log.
lcmName                 = bsmLcm # name of LCM for ID change, A local certificate manager (LCM)
                             # manages sets of end-entity certificates for one or more applications
                             # (PSID/SSPs) that share those certificates (are authorized by those
                             # certificates to sign messages).
idChangeInterval        = 300000 # ms for time interval for ID change request
idChangeDistance       = 2100 # m for distance since last ID change happened to cause another id change
acceptAll               = false # when false, only signed packets are accepted.
                                # when true, both signed/unsigned packets are accepted.
enableMbd               = false # true/false. false by default.
                                # if true, enable misbehavior detection for signed packets.
enableMbdStatLog        = false # true/false. false by default.
                             # If true, logging is enabled and results are
                             # dumped to MisbehaviorStatLogFile on program exit
MbdStatLogListSize      = 10000 # By default this is 10000. This specifies the
                             # logged statistics of the last N checked packets for misbehavior.
                             # Each thread has unique list.
MbdStatLogFile          = /tmp/misbehavior_stats.log
                             # By default, this is /tmp/misbehavior_stats.log.
overrideVerifResult     = false # if true, this will force every verification result to be a failure
overrideVerifValue      = -1    # -1 for failure, any other value for success
enableL2FloodingDetect  = false # if true, l2 flooding detection and mitigation feature is enabled
                                # only usable if security is enabled for qits
floodDetectVerbosity    = 0 # 0-8; console logging level for flooding detection and mitigation feature
commandInterval         = 100 # ms ; basic interval in flooding attack detection
tShiftInterval          = 20 # ms ; the length of the interval used to shift the l2 snoozing start time
nCommandInterval_0      = 10 # num of command intervals in eval interval in state 0
nCommandInterval_1      = 5 # num of command intervals in eval interval in state 1
floodAttackThreshSingle = 100 #msg per sec
floodAttackThreshTotal  = 1000 #msg per sec
loadUpdateInterval      = 1000 # interval for how often mvm load is updated
mvmUtilThreshold        = 0.5 #utilization threshold to determine if should change state
mvmCapacityOverride     = true #flag to override actual mvm capacity for testing purposes
mvmCapacity             = 20 #mvm capacity value to test flooding detection and mitigation feature
# Specifically for Emergency Public Vehicle event handling
emergencyVehicleEventTX = false # if true, emergency public vehicle event messages will be transmitted (Enable this in TX Device).
sspCheck                = false # if true, emergency public vehicle event messages will be handled in the recieving device.(Enable this in RX Device)
expectedSsp             = 01:80 # hexadecimal format bytes separated by colons, expected SSP Value of the emergency public vehicle event messages.
#**************************************************************************
#*                    Simulation Settings                                 *
#**************************************************************************/
SourceIpv4Address       =    # ipv4 address of this device

#**************************************************************************
#*                    Miscellaneous                                       *
#**************************************************************************/
#ASN codec debug level
codecVerbosity          = 0  # Range from 0-8. 8 Showing all details.
ldmVerbosity            = 0  # Range from 0-2. 2 Showing all details of LDM.
appVerbosity            = 0 # Range from 0-8. 8 Showing all details.
# Specifically for Aerolink. Setting Aerolink Env Variables might be more informative
secVerbosity            = 0 # Range from 0-8. 8 Showing all details. 1 shows rate of verification success and failure over time.
verifLatencyQueueSize   = 10000 # Size of latency-logging queue (number of last logged latencies) ; If secVerbosity > 0, the output will be produced on program exit
driverVerbosity         = 0  # Range from 0-8. 8 Showing counts of rx/tx packets
numRxThreadsRadio       = 1  # Min: 1; You can change this as desired but should probably not exceed #actual hardware threads.
numRxThreadsEth         = 1  # Min: 1; You can change this as desired but should probably not exceed #actual hardware threads.
###### Use the following for both rx and tx at same time ########
enableTxAlways          = true # Turn this off if you want to test only RX. Otherwise, tx will happen during rx as well. Only matters when qits ran in receive mode via runtime arguments. Both ethernet and radio.
DestIpv4Address         =       # ONLY FOR ETHERNET: address of destination device, only to be used with
TxPort                  = 9001      # ONLY FOR ETHERNET: should use different port than rx port
# L2 src filtering
filterInterval          = 1000 # ms for rx rate calculation and l2 filtering.
deltaInRxRate           = 200  # Difference in incoming rx rate(no of pkts) to surpass in order to
                               # update verification load to throttle manager. if the rx rate was
                               # 1500 and then it changed below or equal to 1300 or above 1700 in
                               # the next sec TM will be updated.
enableL2SrcFiltering       = false # If true, L2 filtering will be enabled.
l2SrcFilteringTime         = 1 # Duration(seconds) during which messages from the specified RV are filter at the L2 layer and not received by HV.
l2SrcIdTimeThresholdSec    = 5 # parameter that represents the max allowed age for a RV from the timestamps in the last BSM received by HV in seconds.
                               # If the time interval between last BSM received by HV and now is longer than the l2SrcIdTimeThresholdSec then the RV is not tracked.
SpsPriority                = 5 # Range from 0 to 7. Parameter that represents the sps priority used for flow creation, 1 is added to get mapped to the 3GPP priority.
EventPriority              = 2 # Range from 0 to 7. Parameter that represents the event priority used for one-shot transmission, 1 is added to get mapped to the 3GPP priority.
Padding                    = 0 # Range from 0 to 1000. Parameter that represents the padding length added in each transmit BSM, units in bytes.
UnsignedBsmResSize         = 100 # rounded to upper hundred; around 60 for unsigned bsm
SignedBsmResSize           = 300 # rounded to upper hundred; around 150 for bsm with digest, 220 for bsm with cert

#*************************************************************************
#    WRA (Wave Routing Advertisement)                                     *
#*************************************************************************/
# WRA configurations for RSU
wsaInterval = 1000 # WSA transmission interval in miliseconds.
routerLifetime = 100 # in seconds
ipPrefix = 2600:8802:1507:c700    #this should be a valid prefix
ipPrefixLength = 64 #up to 128 bites maximum
#defaultGateway = 2600:8802:1507:c700:0:0:0:1 # This should be a valid IPv6 gateway address.
                                              # V2X-IP rmnet address will be used instead if
                                              # it's not configured.
primaryDns = 2600:8802:1507:c700:0:0:0:2      # This should be a valid IPv6 address of a device
                                              # that can provide DNS lookup for the subset devices.


# WRA configurations for OBU
#wsaInfoFile = /var/tmp/wsa_info.txt # This file is used to store received WSA information in OBU
                                     # The defaultGateway and primaryDns will be stored in this
                                     # file if it's configured.
#*************************************************************************
#    SQUISH (Congestion Control)                                         *
#*************************************************************************/


#will need to convert these fields to the ones in config file that we'll use for qits/squish
enableCongCtrl = false #false, true

#SQUISH CONFIGURATION ITEMS
#type of congestion control
congCtrlType = 0  # sae

# enable logging of SQUISH; Logging Mask
# logging level 0-10
enableCongCtrlLogging = 0

# j2945/1 ; j3161
# channel busy percentage related
cbpMeasInterval     = 100
cbpWeightFactor     = 0.5

# packet error rate related
perInterval = 5000
perSubInterval = 1000
perMax = 0.3

# Inter Transmit Time and Tx Decision related
vRescheduleTh      = 25 # 0, 10000; threshold for helping determine transmit rescheduling
vMax_ITT               = 600 # 0, 10000; maximum inter-transmit time allowed
minItt = 100 # 2x 50 5x 20; minimum inter-transmit time allowed
txRand = 0 # +- noise set to scheduling; but set to 0 for CV2X
timeAccuracy = 1000 # precision for time

# channel quality indication related
minChanQualInd = 0.0 # minimum channel quality indicator value
maxChanQualInd = 0.3 # maximum channel quality indicator value

# density related
vDensityWeightFactor = .05 # lambda used for density smoothing
vDensityCoefficient = 16.06 #16.06 2x; 6.22  5x; 1x = 33.8; default: 25; used for rescheduling based on smoothed density
vDensityMinPerRange = 100 # minimum distance in meters for vehicles to be considered in range
UseStaticVDensity  = 0 # 0,1 # Will cause vDensity to be used instead of calculated density
vDensity           = 10 # 0, 100 # Only used if UseStaticDensity is set

# Tracking Error related
txCtrlInterval = 100 # ms ; interval for periodic Tracking Error and ITT calculations
hvTEMinTimeDiff = 0 # minimum host vehicle tracking error difference
hvTEMaxTimeDiff = 200 # maximum host vehicle tracking error difference
rvTEMinTimeDiff = 0 # minimum host vehicle tracking error difference
rvTEMaxTimeDiff = 3000 # minimum host vehicle tracking error difference
teErrSensitivity = 75 # base error sensitivity value used to calculate probability of successful transmission
teMinThresh = 200 # minimum threshold for tracking error;
teMaxThresh = 500 # maximum threshold for tracking error;

#sps enhancements parameters
enableSpsEnhancements = false # flag for disabling or enabling sps enhancements
cv2xMaxITTRounding      = 0 # 0, 2 # 0 = Disable SPS rounding
                                  # 1 = Round to lower SPS slot
                                  # 2 = Arithmetic rounding
spsEnhIntervalRound = 100 # 20, 1000; the resolution at which we round the ITT to the SPS periodicity
spsEnhHysterPerc = 5 #  hysteresis percentage which determines ITT thresholds for choosing when to change ITT and SPS periodicity
spsEnhDelayPerc = 20 # chance for changing the ITT and SPS periodicity


#qMonitor Configuration Enabled

qMonEnabled = true # Enables qMonitor for statistics

# options to test with a set number of unique RV temp IDs 
fakeRVTempIds = false # Fake the temp ids in RXed BSMs
                            # for testing purposes only
totalFakeRVTempIds = 500 # total number of temp ids to simulate RVs
RVTransmitLossSimulation = 0 # percentage of transmit loss simulation from RVs
